# MySTL 代码风格指南

本文档定义了 MySTL 项目的代码风格规范。所有贡献者应遵循这些规范，以保持代码库的一致性和可读性。

## 目录

1. [命名约定](#命名约定)
2. [代码格式](#代码格式)
3. [注释规范](#注释规范)
4. [头文件组织](#头文件组织)
5. [错误处理](#错误处理)
6. [最佳实践](#最佳实践)
7. [自动格式化](#自动格式化)

## 命名约定

### 文件命名

- 头文件使用 `.hpp` 扩展名
- 源文件使用 `.cpp` 扩展名
- 文件名全部小写，使用下划线分隔单词，例如：`vector.hpp`, `linked_list.hpp`

### 类型命名

- 类名、结构体名、类型别名、枚举名使用驼峰命名法，例如：`Vector`, `ListNode`, `SizeType`
- 模板参数使用驼峰命名法，通常单个大写字母表示简单的模板参数，例如：`template <typename T>`

### 变量命名

- 变量名使用小写字母，单词之间用下划线分隔，例如：`size`, `first_element`
- 成员变量以下划线结尾，例如：`size_`, `data_`
- 常量使用全大写字母，单词之间用下划线分隔，例如：`MAX_SIZE`, `DEFAULT_CAPACITY`

### 函数命名

- 函数名使用小写字母，单词之间用下划线分隔，例如：`push_back()`, `clear()`
- 遵循 STL 的命名约定，保持与标准库一致的接口名称

## 代码格式

### 缩进和空格

- 使用 2 个空格进行缩进，不使用制表符
- 在二元运算符两侧添加空格
- 在控制语句的括号前添加空格，函数调用的括号前不添加空格
- 在逗号后添加空格，逗号前不添加空格

### 行长度

- 每行代码不超过 100 个字符
- 如果一行超过限制，应该在适当的位置换行，并使用 4 个空格的延续缩进

### 括号和大括号

- 控制语句的大括号始终换行放置（Linux 风格）
- 函数定义的大括号始终换行放置
- 空的大括号可以放在同一行：`{}`
- 条件语句必须使用大括号，即使只有一行代码

### 类格式

- 访问修饰符（public、protected、private）缩进 -2 个空格
- 类的成员和方法按照 public、protected、private 的顺序排列
- 在不同的访问修饰符之间添加一个空行

## 注释规范

### 文件注释

每个文件开头应包含以下注释：

```cpp
/**
 * @file filename.hpp
 * @brief 简要描述文件的内容和目的
 * @author 作者名
 * @date YYYY-MM-DD
 */
```

### 类注释

每个类定义前应包含以下注释：

```cpp
/**
 * @brief 类的简要描述
 *
 * 类的详细描述，包括用途、设计考虑等
 */
```

### 函数注释

每个公共函数前应包含以下注释：

```cpp
/**
 * @brief 函数的简要描述
 *
 * 函数的详细描述
 *
 * @param param_name 参数描述
 * @return 返回值描述
 * @throw exception_type 异常描述
 */
```

### 实现注释

- 对于复杂的实现，应添加注释解释算法或逻辑
- 使用 `//` 进行单行注释，注释前应有一个空格
- 避免不必要的注释，代码应该是自解释的

## 头文件组织

### 包含顺序

头文件包含应按照以下顺序排列：

1. 相关的头文件
2. C 系统头文件
3. C++ 系统头文件
4. 其他库的头文件
5. 本项目的头文件

每组之间用一个空行分隔。

### 头文件保护

所有头文件都应使用 `#pragma once` 进行保护：

```cpp
#pragma once

// 头文件内容
```

### 前向声明

尽可能使用前向声明减少不必要的包含：

```cpp
namespace sjkxq_stl {
class SomeClass;  // 前向声明
}
```

## 错误处理

- 使用异常进行错误处理，而不是错误码
- 自定义异常应继承自标准异常类
- 在可能失败的操作中，提供明确的错误信息
- 确保资源在异常发生时能够正确释放（使用 RAII）

## 最佳实践

### 内存管理

- 优先使用智能指针而不是裸指针
- 遵循 RAII 原则（资源获取即初始化）
- 避免内存泄漏和悬空引用

### 性能考虑

- 合理使用内联函数
- 避免不必要的拷贝，使用引用和移动语义
- 考虑内存对齐和缓存友好的数据结构

### 模板编程

- 模板代码应清晰易懂
- 使用 `typename` 而不是 `class` 声明模板类型参数
- 对复杂的模板代码添加详细注释

### 其他

- 避免使用全局变量和函数
- 使用 `const` 修饰不会修改状态的方法和参数
- 优先使用 `nullptr` 而不是 `NULL` 或 `0`
- 使用 `auto` 提高代码可读性，但不要过度使用

## 自动格式化

本项目使用 clang-format 进行代码格式化。项目根目录下的 `.clang-format` 文件定义了格式化规则。

### 使用方法

格式化单个文件：

```bash
clang-format -i path/to/file.cpp
```

格式化整个项目：

```bash
find include tests -name "*.hpp" -o -name "*.cpp" | xargs clang-format -i
```

### 集成到编辑器

大多数现代编辑器和 IDE 都支持 clang-format 集成：

- **VSCode**: 安装 "C/C++" 扩展，启用 "Format On Save" 选项
- **CLion**: 在设置中启用 clang-format 支持
- **Vim**: 使用 ALE 或其他插件集成 clang-format

### 提交前检查

在提交代码前，请确保代码已经通过 clang-format 格式化。可以添加 git 钩子自动检查格式：

```bash
#!/bin/bash
# .git/hooks/pre-commit

FILES=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.(cpp|hpp)$')
if [ -n "$FILES" ]; then
  clang-format -i $FILES
  git add $FILES
fi
```

---

本风格指南将随着项目的发展而更新。如有任何建议或问题，请提交 issue 讨论。